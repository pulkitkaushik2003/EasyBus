<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Booking Confirmed - Bus Booking</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; font-family: 'Segoe UI', sans-serif; }
        .confirmation-container { background: rgba(255,255,255,0.97); border-radius: 18px; padding: 2rem; margin: 2rem auto; max-width: 650px; box-shadow: 0 8px 32px rgba(102,126,234,0.15);}
        .confirmation-title { text-align: center; font-weight: 700; margin-bottom: 2rem; }
        .booking-details, .payment-details { background: #f8f9fa; border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem; }
        .success-icon { font-size: 4rem; text-align: center; margin-bottom: 1rem; }
        .success { color: #28a745; }
        .pending { color: #ffc107; }
        .cancelled { color: #dc3545; }
    </style>
</head>
<body>
<div class="container confirmation-container">

    <!-- Booking Status -->
    <div th:if="${booking}">
        <div th:if="${booking.status.name() == 'CONFIRMED'}" class="text-center">
            <div class="success-icon success">✓</div>
            <h2 class="confirmation-title success">Booking Confirmed!</h2>
        </div>
        <div th:if="${booking.status.name() == 'PENDING'}" class="text-center">
            <div class="success-icon pending">⌛</div>
            <h2 class="confirmation-title pending">Booking Pending - Awaiting Payment</h2>
        </div>
        <div th:if="${booking.status.name() == 'CANCELLED'}" class="text-center">
            <div class="success-icon cancelled">✕</div>
            <h2 class="confirmation-title cancelled">Booking Cancelled</h2>
        </div>
    </div>

    <!-- Booking Details -->
    <div th:if="${booking}" class="booking-details">
        <h5>Booking Details</h5>
        <p><strong>Booking ID:</strong> <span th:text="${booking.id}"></span></p>
        <p><strong>Status:</strong> <span th:text="${booking.status}"></span></p>
        <p><strong>Name:</strong> <span th:text="${booking.userName}"></span></p>
        <p><strong>Email:</strong> <span th:text="${booking.userEmail}"></span></p>
        <p><strong>Route:</strong> <span th:text="${booking.routeName}"></span></p>
        <p><strong>From:</strong> <span th:text="${booking.fromLocation}"></span></p>
        <p><strong>To:</strong> <span th:text="${booking.toLocation}"></span></p>
        <p><strong>Travel Date:</strong> <span th:text="${booking.travelDate}"></span></p>
        <p><strong>Seats Booked:</strong> <span th:text="${booking.seatsBooked}"></span></p>
        <p><strong>Total Fare:</strong> ₹<span th:text="${booking.fare * booking.seatsBooked}"></span></p>
    </div>

    <!-- Payment Details -->
    <div th:if="${paymentDetails}" class="payment-details">
        <h5>Payment Details</h5>
        <p><strong>Transaction ID:</strong> <span th:text="${paymentDetails.transactionId}"></span></p>
        <p><strong>Payment Method:</strong> <span th:text="${paymentDetails.paymentMethod}"></span></p>
        <p><strong>Paid Amount:</strong> ₹ <span th:text="${paymentDetails.amount}"></span></p>
        <p><strong>Payment Status:</strong> <span th:text="${paymentDetails.status}"></span></p>
        <p><strong>Payment Time:</strong><span th:text="${paymentDetails.createdAt != null ? #temporals.format(paymentDetails.createdAt, 'dd-MM-yyyy HH:mm') : 'N/A'}"></span></p>
    </div>

    <!-- Buttons -->
    <div class="text-center">
        <a href="/userroutes" class="btn btn-primary me-2">Book Another Ticket</a>
        <a href="/userroutes" class="btn btn-secondary me-2">Back to Routes</a>
        <form th:action="@{/api/cancel-booking}" method="post" style="display:inline">
            <input type="hidden" name="bookingId" th:value="${booking.id}"/>
            <button type="submit" class="btn btn-danger" th:if="${booking.status.name() != 'CANCELLED'}">Cancel Booking</button>
        </form>
    </div>

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
