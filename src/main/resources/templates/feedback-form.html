<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Submit Feedback - Bus Booking</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .feedback-container {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 18px;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 600px;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.15);
        }
        
        .feedback-title {
            text-align: center;
            font-weight: 700;
            margin-bottom: 2rem;
            color: #2d3e50;
        }
        
        .booking-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .star-rating {
            display: flex;
            justify-content: center;
            margin: 1.5rem 0;
        }
        
        .star-rating input {
            display: none;
        }
        
        .star-rating label {
            font-size: 2rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
            margin: 0 0.2rem;
        }
        
        .star-rating input:checked ~ label,
        .star-rating label:hover,
        .star-rating label:hover ~ label {
            color: #ffc107;
        }
        
        .star-rating input:checked + label {
            color: #ffc107;
        }
        
        .btn-submit {
            background: #667eea;
            border: none;
            padding: 0.75rem 2rem;
            font-size: 1.1rem;
            border-radius: 8px;
        }
        
        .btn-submit:hover {
            background: #5665d3;
        }
        
        .alert {
            border-radius: 10px;
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/dashboard">
            <i class="fas fa-bus me-2"></i>BusLink
        </a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/userroutes"><i class="fas fa-route me-1"></i>Browse Routes</a>
            <a class="nav-link" href="/my-bookings"><i class="fas fa-ticket-alt me-1"></i>My Bookings</a>
            <form th:action="@{/logout}" method="post" class="d-inline">
                <button type="submit" class="btn btn-outline-danger btn-sm">
                    <i class="fas fa-sign-out-alt me-1"></i>Logout
                </button>
            </form>
        </div>
    </div>
</nav>

<div class="container feedback-container">
    <!-- Error/Success Messages -->
    <div th:if="${error}" class="alert alert-danger" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i>
        <span th:text="${error}"></span>
    </div>
    
    <div th:if="${success}" class="alert alert-success" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        <span th:text="${success}"></span>
    </div>

    <h2 class="feedback-title">
        <i class="fas fa-star me-2"></i>Share Your Experience
    </h2>

    <!-- Admin-only notice -->
    <div class="alert alert-info" role="alert">
        <i class="fas fa-info-circle me-2"></i>
        <strong>Note:</strong> Your feedback will be visible to administrators only for review purposes.
    </div>

    <!-- Booking Information -->
    <div class="booking-info" th:if="${booking}">
        <h5>Booking Details</h5>
        <p><strong>Route:</strong> <span th:text="${booking.routeName}"></span></p>
        <p><strong>From:</strong> <span th:text="${booking.fromLocation}"></span> â†’ <strong>To:</strong> <span th:text="${booking.toLocation}"></span></p>
        <p><strong>Travel Date:</strong> <span th:text="${#temporals.format(booking.travelDate, 'dd-MMM-yyyy')}"></span></p>
        <p><strong>Booking ID:</strong> <span th:text="${booking.id}"></span></p>
    </div>

    <!-- Feedback Form -->
    <form th:action="@{'/feedback/' + ${booking.id}}" method="post">
        <!-- Star Rating -->
        <div class="star-rating">
            <input type="radio" id="star5" name="rating" value="5" required>
            <label for="star5"><i class="fas fa-star"></i></label>
            
            <input type="radio" id="star4" name="rating" value="4">
            <label for="star4"><i class="fas fa-star"></i></label>
            
            <input type="radio" id="star3" name="rating" value="3">
            <label for="star3"><i class="fas fa-star"></i></label>
            
            <input type="radio" id="star2" name="rating" value="2">
            <label for="star2"><i class="fas fa-star"></i></label>
            
            <input type="radio" id="star1" name="rating" value="1">
            <label for="star1"><i class="fas fa-star"></i></label>
        </div>

        <!-- Comments -->
        <div class="mb-4">
            <label for="comments" class="form-label">
                <i class="fas fa-comment me-1"></i>Share your experience (optional)
            </label>
            <textarea class="form-control" id="comments" name="comments" rows="4" 
                      placeholder="Tell us about your journey... What did you like? How can we improve?"
                      maxlength="1000"></textarea>
            <div class="form-text">Maximum 1000 characters</div>
        </div>

        <!-- Buttons -->
        <div class="text-center">
            <button type="submit" class="btn btn-submit me-3">
                <i class="fas fa-paper-plane me-2"></i>Submit Feedback
            </button>
            <a href="/my-bookings" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to Bookings
            </a>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Star rating hover effect
    document.addEventListener('DOMContentLoaded', function() {
        const stars = document.querySelectorAll('.star-rating label');
        
        stars.forEach(star => {
            star.addEventListener('mouseenter', function() {
                const rating = this.previousElementSibling.value;
                highlightStars(rating);
            });
            
            star.addEventListener('mouseleave', function() {
                const checkedStar = document.querySelector('.star-rating input:checked');
                if (checkedStar) {
                    highlightStars(checkedStar.value);
                } else {
                    resetStars();
                }
            });
        });
        
        function highlightStars(rating) {
            stars.forEach(star => {
                const starInput = star.previousElementSibling;
                if (starInput.value <= rating) {
                    star.style.color = '#ffc107';
                } else {
                    star.style.color = '#ddd';
                }
            });
        }
        
        function resetStars() {
            stars.forEach(star => {
                star.style.color = '#ddd';
            });
        }
    });
</script>
</body>
</html>
